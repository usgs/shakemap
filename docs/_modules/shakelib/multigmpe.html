
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>shakelib.multigmpe &#8212; ShakeMap Documentation  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/northridge_points.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for shakelib.multigmpe</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">import_module</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">openquake.hazardlib.gsim.base</span> <span class="k">import</span> <span class="n">GMPE</span><span class="p">,</span> <span class="n">IPE</span>
<span class="kn">from</span> <span class="nn">openquake.hazardlib.gsim.boore_2014</span> <span class="k">import</span> <span class="n">BooreEtAl2014</span>
<span class="kn">from</span> <span class="nn">openquake.hazardlib.gsim.campbell_bozorgnia_2014</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">CampbellBozorgnia2014</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">openquake.hazardlib.imt</span> <span class="k">import</span> <span class="n">PGA</span><span class="p">,</span> <span class="n">PGV</span><span class="p">,</span> <span class="n">SA</span>
<span class="kn">from</span> <span class="nn">openquake.hazardlib</span> <span class="k">import</span> <span class="n">const</span>

<span class="kn">from</span> <span class="nn">shakelib.conversions.imt.newmark_hall_1982</span> <span class="k">import</span> <span class="n">NewmarkHall1982</span>
<span class="kn">from</span> <span class="nn">shakelib.conversions.imc.boore_kishida_2017</span> <span class="k">import</span> <span class="n">BooreKishida2017</span>
<span class="kn">from</span> <span class="nn">shakelib.sites</span> <span class="k">import</span> <span class="n">Sites</span>


<div class="viewcode-block" id="MultiGMPE"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE">[docs]</a><span class="k">class</span> <span class="nc">MultiGMPE</span><span class="p">(</span><span class="n">GMPE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements a GMPE that is the combination of multiple GMPEs.</span>

<span class="sd">    To do</span>

<span class="sd">        * Allow site to be based on a model that isn&#39;t a GMPE (e.g.,</span>
<span class="sd">          Borcherdt).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFINED_FOR_TECTONIC_REGION_TYPE</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">DEFINED_FOR_INTENSITY_MEASURE_TYPES</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">DEFINED_FOR_INTENSITY_MEASURE_COMPONENT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">DEFINED_FOR_STANDARD_DEVIATION_TYPES</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">REQUIRES_SITES_PARAMETERS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">REQUIRES_RUPTURE_PARAMETERS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">REQUIRES_DISTANCES</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MultiGMPE.get_mean_and_stddevs"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.get_mean_and_stddevs">[docs]</a>    <span class="k">def</span> <span class="nf">get_mean_and_stddevs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span> <span class="n">stddev_types</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See superclass `method &lt;http://docs.openquake.org/oq-hazardlib/master/gsim/index.html#openquake.hazardlib.gsim.base.GroundShakingIntensityModel.get_mean_and_stddevs&gt;`__.</span>

<span class="sd">        Unlike the superclass method, the stddev list returned by this</span>
<span class="sd">        function will have twice as many arrays as are requested in</span>
<span class="sd">        stddev_types: The first set will include the standard deviation</span>
<span class="sd">        inflation due to the point-source to finite fault conversion (if</span>
<span class="sd">        any), and the second set will not include this inflation. In the</span>
<span class="sd">        case where a finite rupture is provided (and, thus, no point-source</span>
<span class="sd">        to finite rupture adjustments are made) the two sets of stddev</span>
<span class="sd">        arrays will be identical. Thus, if::</span>

<span class="sd">            stddev_types = [const.StdDev.TOTAL, const.StdDev.INTRA_EVENT,</span>
<span class="sd">                            const.StdDev.INTER_EVENT]</span>

<span class="sd">        the returned stddev list will contain six arrays: the first three</span>
<span class="sd">        will include the point-source inflation, and the second three will</span>
<span class="sd">        not.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Sort out shapes of sites and dists elements</span>
        <span class="c1"># Need to turn all 2D arrays into 1D arrays because of</span>
        <span class="c1"># inconsistencies in how arrays are handled in OpenQuake.</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sites</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;_slots_&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lons&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lats&#39;</span><span class="p">):</span>
                <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">sites</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dists</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;_slots_&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lons&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lats&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">dists</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">shapeset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapeset</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;All sites and dists elements must have same shape.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orig_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shapeset</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">sd_avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFINED_FOR_STANDARD_DEVIATION_TYPES</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sd_avail</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stddev_types</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Requested an unavailable stddev_type.&quot;</span><span class="p">)</span>

        <span class="c1"># Evaluate MultiGMPE:</span>
        <span class="n">lnmu</span><span class="p">,</span> <span class="n">lnsd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_mean_and_stddevs</span><span class="p">(</span>
            <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span> <span class="n">stddev_types</span><span class="p">)</span>

        <span class="c1"># Check for large-distance cutoff/weights</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;CUTOFF_DISTANCE&#39;</span><span class="p">):</span>
            <span class="n">lnmu_large</span><span class="p">,</span> <span class="n">lnsd_large</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_mean_and_stddevs</span><span class="p">(</span>
                <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span> <span class="n">stddev_types</span><span class="p">,</span> <span class="n">large_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Stomp on lnmu and lnsd at large distances</span>
            <span class="n">dist_cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CUTOFF_DISTANCE</span>
            <span class="n">lnmu</span><span class="p">[</span><span class="n">dists</span><span class="o">.</span><span class="n">rjb</span> <span class="o">&gt;</span> <span class="n">dist_cutoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">lnmu_large</span><span class="p">[</span><span class="n">dists</span><span class="o">.</span><span class="n">rjb</span> <span class="o">&gt;</span> <span class="n">dist_cutoff</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lnsd</span><span class="p">)):</span>
                <span class="n">lnsd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dists</span><span class="o">.</span><span class="n">rjb</span> <span class="o">&gt;</span> <span class="n">dist_cutoff</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">lnsd_large</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dists</span><span class="o">.</span><span class="n">rjb</span> <span class="o">&gt;</span> <span class="n">dist_cutoff</span><span class="p">]</span>

        <span class="c1"># Undo reshapes of inputs</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dists</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;_slots_&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lons&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lats&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dists</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">orig_shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sites</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;_slots_&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lons&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lats&#39;</span><span class="p">):</span>
                <span class="n">sites</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">orig_shape</span><span class="p">)</span>

        <span class="c1"># Reshape output</span>
        <span class="n">lnmu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lnmu</span><span class="p">,</span> <span class="n">orig_shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lnsd</span><span class="p">)):</span>
            <span class="n">lnsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lnsd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">orig_shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lnmu</span><span class="p">,</span> <span class="n">lnsd</span></div>

    <span class="k">def</span> <span class="nf">__get_mean_and_stddevs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span> <span class="n">stddev_types</span><span class="p">,</span>
                               <span class="n">large_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Sort out which set of weights to use</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">large_dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">wts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WEIGHTS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WEIGHTS_LARGE_DISTANCE</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># These are arrays to hold the weighted combination of the GMPEs</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">lnmu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="n">vs30</span><span class="p">)</span>
        <span class="n">lnsd2</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="n">vs30</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">stddev_types</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gmpe</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMPES</span><span class="p">):</span>
            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># Loop over GMPE list</span>
            <span class="c1"># -----------------------------------------------------------------</span>

            <span class="n">sites</span> <span class="o">=</span> <span class="n">MultiGMPE</span><span class="o">.</span><span class="n">set_sites_depth_parameters</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">gmpe</span><span class="p">)</span>

            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># Select the IMT</span>
            <span class="c1"># -----------------------------------------------------------------</span>

            <span class="n">gmpe_imts</span> <span class="o">=</span> <span class="p">[</span><span class="n">imt</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">imt</span> <span class="ow">in</span>
                         <span class="n">gmpe</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_TYPES</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="n">MultiGMPE</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">imt</span><span class="p">,</span> <span class="n">PGV</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;PGV&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gmpe_imts</span><span class="p">):</span>
                <span class="n">timt</span> <span class="o">=</span> <span class="n">SA</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timt</span> <span class="o">=</span> <span class="n">imt</span>

            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># Grab GMPE_LIMITS in gmpe instance for later as the multigmpe</span>
            <span class="c1"># nests downward.</span>
            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GMPE_LIMITS&#39;</span><span class="p">):</span>
                <span class="c1"># Remember that GMPE_LIMITS is only present if it is getting</span>
                <span class="c1"># loaded from a config... we could change this eventually.</span>
                <span class="n">gmpe</span><span class="o">.</span><span class="n">GMPE_LIMITS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMPE_LIMITS</span>

            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># Apply GMPE_LIMITS if applicable</span>
            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="s1">&#39;GMPE_LIMITS&#39;</span><span class="p">):</span>
                <span class="n">gmpes_with_limits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gmpe</span><span class="o">.</span><span class="n">GMPE_LIMITS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">gmpe_class_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gmpe</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gmpe_class_str</span> <span class="ow">in</span> <span class="n">gmpes_with_limits</span><span class="p">:</span>
                    <span class="n">limit_dict</span> <span class="o">=</span> <span class="n">gmpe</span><span class="o">.</span><span class="n">GMPE_LIMITS</span><span class="p">[</span><span class="n">gmpe_class_str</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">limit_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;vs30&#39;</span><span class="p">:</span>
                            <span class="n">vs30min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">vs30max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">sites</span><span class="o">.</span><span class="n">vs30</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="n">vs30</span><span class="p">,</span> <span class="n">vs30min</span><span class="p">,</span> <span class="n">vs30max</span><span class="p">)</span>

            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># Evaluate</span>
            <span class="c1"># -----------------------------------------------------------------</span>

            <span class="n">lmean</span><span class="p">,</span> <span class="n">lsd</span> <span class="o">=</span> <span class="n">gmpe</span><span class="o">.</span><span class="n">get_mean_and_stddevs</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">timt</span><span class="p">,</span>
                                                   <span class="n">stddev_types</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="n">MultiGMPE</span><span class="p">):</span>
                <span class="c1"># -------------------------------------------------------------</span>
                <span class="c1"># We may need to inflate the standard deviations to account for</span>
                <span class="c1"># the point-source to finite rupture conversion.</span>
                <span class="c1"># -------------------------------------------------------------</span>
                <span class="n">lsd_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflatePSSigma</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="n">lmean</span><span class="p">,</span> <span class="n">lsd</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span>
                                              <span class="n">dists</span><span class="p">,</span> <span class="n">timt</span><span class="p">,</span> <span class="n">stddev_types</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sd</span> <span class="ow">in</span> <span class="n">lsd</span><span class="p">:</span>
                    <span class="n">lsd_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
                <span class="n">lsd</span> <span class="o">=</span> <span class="n">lsd_new</span>

                <span class="c1"># -------------------------------------------------------------</span>
                <span class="c1"># If IMT is PGV and PGV is not given by the GMPE, then</span>
                <span class="c1"># convert from PSA10.</span>
                <span class="c1"># -------------------------------------------------------------</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">imt</span><span class="p">,</span> <span class="n">PGV</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;PGV&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gmpe_imts</span><span class="p">):</span>
                    <span class="n">nh82</span> <span class="o">=</span> <span class="n">NewmarkHall1982</span><span class="p">()</span>
                    <span class="n">lmean</span> <span class="o">=</span> <span class="n">nh82</span><span class="o">.</span><span class="n">convertAmps</span><span class="p">(</span><span class="s1">&#39;PSA10&#39;</span><span class="p">,</span> <span class="s1">&#39;PGV&#39;</span><span class="p">,</span> <span class="n">lmean</span><span class="p">)</span>
                    <span class="c1"># Put the extra sigma from NH82 into intra event and total</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">stddev_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stddev_types</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">stddev_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">StdDev</span><span class="o">.</span><span class="n">INTER_EVENT</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">lsd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">nh82</span><span class="o">.</span><span class="n">convertSigmas</span><span class="p">(</span><span class="s1">&#39;PSA10&#39;</span><span class="p">,</span> <span class="s1">&#39;PGV&#39;</span><span class="p">,</span> <span class="n">lsd</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                <span class="c1"># -------------------------------------------------------------</span>
                <span class="c1"># -------------------------------------------------------------</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HAS_SITE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">lamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_site_factors</span><span class="p">(</span>
                        <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">timt</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lmean</span> <span class="o">=</span> <span class="n">lmean</span> <span class="o">+</span> <span class="n">lamps</span>

                <span class="c1"># -------------------------------------------------------------</span>
                <span class="c1"># Convertions due to component definition</span>
                <span class="c1"># -------------------------------------------------------------</span>
                <span class="n">imc_in</span> <span class="o">=</span> <span class="n">gmpe</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_COMPONENT</span>
                <span class="n">imc_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_COMPONENT</span>
                <span class="k">if</span> <span class="n">imc_in</span> <span class="o">!=</span> <span class="n">imc_out</span><span class="p">:</span>
                    <span class="n">bk17</span> <span class="o">=</span> <span class="n">BooreKishida2017</span><span class="p">(</span><span class="n">imc_in</span><span class="p">,</span> <span class="n">imc_out</span><span class="p">)</span>
                    <span class="n">lmean</span> <span class="o">=</span> <span class="n">bk17</span><span class="o">.</span><span class="n">convertAmps</span><span class="p">(</span><span class="n">imt</span><span class="p">,</span> <span class="n">lmean</span><span class="p">,</span> <span class="n">dists</span><span class="o">.</span><span class="n">rrup</span><span class="p">,</span> <span class="n">rup</span><span class="o">.</span><span class="n">mag</span><span class="p">)</span>
                    <span class="c1">#</span>
                    <span class="c1"># The extra sigma from the component conversion appears to</span>
                    <span class="c1"># apply to the total sigma, so the question arises as to</span>
                    <span class="c1"># how to apportion it between the intra- and inter-event</span>
                    <span class="c1"># sigma. Here we assume it all enters as intra-event sigma.</span>
                    <span class="c1">#</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">stddev_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stddev_types</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">stddev_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">StdDev</span><span class="o">.</span><span class="n">INTER_EVENT</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">lsd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">bk17</span><span class="o">.</span><span class="n">convertSigmas</span><span class="p">(</span><span class="n">imt</span><span class="p">,</span> <span class="n">lsd</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="c1"># End: if GMPE is not MultiGMPE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">lsd</span><span class="p">):</span>
                    <span class="n">lsd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># At this point lsd will have 2 * len(stddev_types) entries, the</span>
            <span class="c1"># first group will have the point-source to finite rupture</span>
            <span class="c1"># inflation (if any), and the second set will not; in cases where</span>
            <span class="c1"># a finite rupture is used, the two sets will be identical</span>
            <span class="c1">#</span>

            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># Compute weighted mean and sd</span>
            <span class="c1"># -----------------------------------------------------------------</span>

            <span class="n">lnmu</span> <span class="o">=</span> <span class="n">lnmu</span> <span class="o">+</span> <span class="n">wts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">lmean</span>

            <span class="c1"># Note: the lnsd2 calculation isn&#39;t complete until we drop out of</span>
            <span class="c1"># this loop and subtract lnmu**2</span>
            <span class="c1"># For an explanation of this method, see:</span>
            <span class="c1"># https://stats.stackexchange.com/questions/16608/what-is-the-variance-of-the-weighted-mixture-of-two-gaussians  # noqa</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sd2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lnsd2</span><span class="p">):</span>
                <span class="n">lnsd2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd2</span> <span class="o">+</span> <span class="n">wts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">lmean</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sd2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lnsd2</span><span class="p">):</span>
            <span class="n">lnsd2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd2</span> <span class="o">-</span> <span class="n">lnmu</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">lnsd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">lnsd2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lnmu</span><span class="p">,</span> <span class="n">lnsd</span>

<div class="viewcode-block" id="MultiGMPE.from_config"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.from_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">filter_imt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a MultiGMPE from a config file.</span>

<span class="sd">        Args:</span>
<span class="sd">            conf (dict): Dictionary of config options.</span>
<span class="sd">            filter_imt (IMT): An optional IMT to filter/reweight the GMPE list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MultiGMPE object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">IMC</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">IMC</span><span class="p">,</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;interp&#39;</span><span class="p">][</span><span class="s1">&#39;component&#39;</span><span class="p">])</span>
        <span class="n">selected_gmpe</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;modeling&#39;</span><span class="p">][</span><span class="s1">&#39;gmpe&#39;</span><span class="p">]</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;selected_gmpe: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">selected_gmpe</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;IMC: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">IMC</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Allow for selected_gmpe to be found in either conf[&#39;gmpe_sets&#39;] or</span>
        <span class="c1"># conf[&#39;gmpe_modules&#39;], if it is a GMPE set, then all entries must be</span>
        <span class="c1"># either a GMPE or a GMPE set (cannot have a GMPE set that is a mix of</span>
        <span class="c1"># GMPEs and GMPE sets).</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">selected_gmpe</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">selected_gmpe_sets</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">selected_gmpe</span><span class="p">][</span><span class="s1">&#39;gmpes&#39;</span><span class="p">]</span>
            <span class="n">gmpe_set_weights</span> <span class="o">=</span> \
                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">selected_gmpe</span><span class="p">][</span><span class="s1">&#39;weights&#39;</span><span class="p">]]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;selected_gmpe_sets: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">selected_gmpe_sets</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;gmpe_set_weights: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">gmpe_set_weights</span><span class="p">)</span>

            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="c1"># If it is a GMPE set, does it contain GMPEs or GMPE sets?</span>
            <span class="c1"># -----------------------------------------------------------------</span>

            <span class="n">set_of_gmpes</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">s</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span>
                                <span class="n">selected_gmpe_sets</span><span class="p">])</span>
            <span class="n">set_of_sets</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">s</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span>
                               <span class="n">selected_gmpe_sets</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">set_of_sets</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">mgmpes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">selected_gmpe_sets</span><span class="p">:</span>
                    <span class="n">mgmpes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__multigmpe_from_gmpe_set</span><span class="p">(</span>
                        <span class="n">conf</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">filter_imt</span><span class="o">=</span><span class="n">filter_imt</span><span class="p">))</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">MultiGMPE</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">mgmpes</span><span class="p">,</span> <span class="n">gmpe_set_weights</span><span class="p">,</span> <span class="n">imc</span><span class="o">=</span><span class="n">IMC</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">set_of_gmpes</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__multigmpe_from_gmpe_set</span><span class="p">(</span>
                    <span class="n">conf</span><span class="p">,</span>
                    <span class="n">selected_gmpe</span><span class="p">,</span>
                    <span class="n">filter_imt</span><span class="o">=</span><span class="n">filter_imt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must consist exclusively of keys in &quot;</span>
                                <span class="s2">&quot;conf[&#39;gmpe_modules&#39;] or conf[&#39;gmpe_sets&#39;]&quot;</span>
                                <span class="o">%</span> <span class="n">selected_gmpe</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">selected_gmpe</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">modinfo</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">][</span><span class="n">selected_gmpe</span><span class="p">]</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">modinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tmpclass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">modinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">MultiGMPE</span><span class="o">.</span><span class="n">from_list</span><span class="p">([</span><span class="n">tmpclass</span><span class="p">()],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">imc</span><span class="o">=</span><span class="n">IMC</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;conf[&#39;modeling&#39;][&#39;gmpe&#39;] must be a key in &quot;</span>
                            <span class="s2">&quot;conf[&#39;gmpe_modules&#39;] or conf[&#39;gmpe_sets&#39;]&quot;</span><span class="p">)</span>

        <span class="n">out</span><span class="o">.</span><span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="n">selected_gmpe</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Deal with GMPE limits</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">gmpe_lims</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_limits&#39;</span><span class="p">]</span>

        <span class="c1"># We need to replace the short name in the dictionary key with module</span>
        <span class="c1"># name here since the conf is not available within the MultiGMPE class.</span>
        <span class="n">mods</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">]</span>
        <span class="n">mod_keys</span> <span class="o">=</span> <span class="n">mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">gmpe_lims</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mod_keys</span><span class="p">:</span>
                <span class="n">gmpe_lims</span><span class="p">[</span><span class="n">mods</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gmpe_lims</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="n">out</span><span class="o">.</span><span class="n">GMPE_LIMITS</span> <span class="o">=</span> <span class="n">gmpe_lims</span>

        <span class="k">return</span> <span class="n">out</span></div>

    <span class="k">def</span> <span class="nf">__multigmpe_from_gmpe_set</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">filter_imt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method for constructing a MultiGMPE from a set_name.</span>

<span class="sd">        Args:</span>
<span class="sd">            conf (ConfigObj): A ShakeMap config object.</span>
<span class="sd">            filter_imt (IMT): An optional IMT to filter/reweight the GMPE list.</span>
<span class="sd">            set_name (str): Set name; must correspond to a key in</span>
<span class="sd">                conf[&#39;set_name&#39;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            MultiGMPE.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">IMC</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">IMC</span><span class="p">,</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;interp&#39;</span><span class="p">][</span><span class="s1">&#39;component&#39;</span><span class="p">])</span>

        <span class="n">selected_gmpes</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;gmpes&#39;</span><span class="p">]</span>
        <span class="n">selected_gmpe_weights</span> <span class="o">=</span> \
            <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;weights&#39;</span><span class="p">]]</span>

        <span class="c1"># Check for large distance GMPEs</span>
        <span class="k">if</span> <span class="s1">&#39;weights_large_dist&#39;</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;weights_large_dist&#39;</span><span class="p">]:</span>
                <span class="n">selected_weights_large_dist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected_weights_large_dist</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span>
                     <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;weights_large_dist&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_weights_large_dist</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s1">&#39;dist_cutoff&#39;</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;dist_cutoff&#39;</span><span class="p">]):</span>
                <span class="n">selected_dist_cutoff</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected_dist_cutoff</span> <span class="o">=</span> \
                    <span class="nb">float</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;dist_cutoff&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_dist_cutoff</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s1">&#39;site_gmpes&#39;</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;site_gmpes&#39;</span><span class="p">]:</span>
                <span class="n">selected_site_gmpes</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected_site_gmpes</span> <span class="o">=</span> \
                    <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;site_gmpes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_site_gmpes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s1">&#39;weights_site_gmpes&#39;</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;weights_site_gmpes&#39;</span><span class="p">]:</span>
                <span class="n">selected_weights_site_gmpes</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected_weights_site_gmpes</span> <span class="o">=</span> \
                    <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_sets&#39;</span><span class="p">][</span><span class="n">set_name</span><span class="p">][</span><span class="s1">&#39;weights_site_gmpes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_weights_site_gmpes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Import GMPE modules and initialize classes into list</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">gmpes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">selected_gmpes</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">][</span><span class="n">g</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tmpclass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">][</span><span class="n">g</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gmpes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpclass</span><span class="p">())</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Filter out GMPEs not applicable to this period</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">filter_imt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filtered_gmpes</span><span class="p">,</span> <span class="n">filtered_wts</span> <span class="o">=</span> <span class="n">filter_gmpe_list</span><span class="p">(</span>
                <span class="n">gmpes</span><span class="p">,</span> <span class="n">selected_gmpe_weights</span><span class="p">,</span> <span class="n">filter_imt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_gmpes</span><span class="p">,</span> <span class="n">filtered_wts</span> <span class="o">=</span> <span class="n">gmpes</span><span class="p">,</span> <span class="n">selected_gmpe_weights</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Import site GMPEs</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">selected_site_gmpes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selected_site_gmpes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">selected_site_gmpes</span> <span class="o">=</span> <span class="p">[</span><span class="n">selected_site_gmpes</span><span class="p">]</span>
            <span class="n">site_gmpes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">selected_site_gmpes</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">][</span><span class="n">g</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">tmpclass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;gmpe_modules&#39;</span><span class="p">][</span><span class="n">g</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">site_gmpes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpclass</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">site_gmpes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Filter out site GMPEs not applicable to this period</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">site_gmpes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filter_imt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filtered_site_gmpes</span><span class="p">,</span> <span class="n">filtered_site_wts</span> <span class="o">=</span> <span class="n">filter_gmpe_list</span><span class="p">(</span>
                    <span class="n">site_gmpes</span><span class="p">,</span> <span class="n">selected_weights_site_gmpes</span><span class="p">,</span> <span class="n">filter_imt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filtered_site_gmpes</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">site_gmpes</span><span class="p">)</span>
                <span class="n">filtered_site_wts</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">selected_weights_site_gmpes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_site_gmpes</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">filtered_site_wts</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Construct MultiGMPE</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;    filtered_gmpes: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filtered_gmpes</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;    filtered_wts: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filtered_wts</span><span class="p">)</span>

        <span class="n">mgmpe</span> <span class="o">=</span> <span class="n">MultiGMPE</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
            <span class="n">filtered_gmpes</span><span class="p">,</span> <span class="n">filtered_wts</span><span class="p">,</span>
            <span class="n">default_gmpes_for_site</span><span class="o">=</span><span class="n">filtered_site_gmpes</span><span class="p">,</span>
            <span class="n">default_gmpes_for_site_weights</span><span class="o">=</span><span class="n">filtered_site_wts</span><span class="p">,</span>
            <span class="n">imc</span><span class="o">=</span><span class="n">IMC</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Append large-distance info if specified</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">selected_dist_cutoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filter_imt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filtered_gmpes_ld</span><span class="p">,</span> <span class="n">filtered_wts_ld</span> <span class="o">=</span> <span class="n">filter_gmpe_list</span><span class="p">(</span>
                    <span class="n">gmpes</span><span class="p">,</span> <span class="n">selected_weights_large_dist</span><span class="p">,</span> <span class="n">filter_imt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filtered_wts_ld</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">selected_weights_large_dist</span><span class="p">)</span>

            <span class="n">mgmpe</span><span class="o">.</span><span class="n">CUTOFF_DISTANCE</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">selected_dist_cutoff</span><span class="p">)</span>
            <span class="n">mgmpe</span><span class="o">.</span><span class="n">WEIGHTS_LARGE_DISTANCE</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filtered_wts_ld</span><span class="p">)</span>

        <span class="n">mgmpe</span><span class="o">.</span><span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="n">set_name</span>

        <span class="k">return</span> <span class="n">mgmpe</span>

<div class="viewcode-block" id="MultiGMPE.from_list"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.from_list">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">gmpes</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span>
                  <span class="n">imc</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">IMC</span><span class="o">.</span><span class="n">GREATER_OF_TWO_HORIZONTAL</span><span class="p">,</span>
                  <span class="n">default_gmpes_for_site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">default_gmpes_for_site_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">reference_vs30</span><span class="o">=</span><span class="mi">760</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a MultiGMPE instance from lists of GMPEs and weights.</span>

<span class="sd">        Args:</span>
<span class="sd">            gmpes (list): List of OpenQuake</span>
<span class="sd">                `GMPE &lt;http://docs.openquake.org/oq-hazardlib/master/gsim/index.html#built-in-gsims&gt;`__</span>
<span class="sd">                instances.</span>

<span class="sd">            weights (list): List of weights; must sum to 1.0.</span>

<span class="sd">            imc: Requested intensity measure component. Must be one listed</span>
<span class="sd">                `here &lt;http://docs.openquake.org/oq-hazardlib/master/const.html?highlight=imc#openquake.hazardlib.const.IMC&gt;`__.</span>
<span class="sd">                The amplitudes returned by the GMPEs will be converted to this</span>
<span class="sd">                IMT. Default is &#39;GREATER_OF_TWO_HORIZONTAL&#39;, which is used by</span>
<span class="sd">                ShakeMap. See discussion in</span>
<span class="sd">                `this section &lt;http://usgs.github.io/shakemap/tg_choice_of_parameters.html#use-of-peak-values-rather-than-mean&gt;`__</span>
<span class="sd">                of the ShakeMap manual.</span>

<span class="sd">            default_gmpes_for_site (list):</span>
<span class="sd">                Optional list of OpenQuake GMPE instance to use as a site term</span>
<span class="sd">                for any of the GMPEs that do not have a site term.</span>

<span class="sd">                Notes:</span>

<span class="sd">                    * We do not check for consistency in the reference rock</span>
<span class="sd">                      defintion, so the user nees to be aware of this issue and</span>
<span class="sd">                      holds responsibiilty for ensuring compatibility.</span>
<span class="sd">                    * We check whether or not a GMPE has a site term by c</span>
<span class="sd">                      hecking the REQUIRES_SITES_PARAMETERS slot for vs30.</span>

<span class="sd">            default_gmpes_for_site_weights: Weights for default_gmpes_for_site.</span>
<span class="sd">                Must sum to one and be same length as default_gmpes_for_site.</span>
<span class="sd">                If None, then weights are set to be equal.</span>

<span class="sd">            reference_vs30:</span>
<span class="sd">                Reference rock Vs30 in m/s. We do not check that this matches</span>
<span class="sd">                the reference rock in the GMPEs so this is the responsibility</span>
<span class="sd">                of the user.</span>

<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Check that GMPE weights sum to 1.0:</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-7</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Weights must sum to one.&#39;</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Check that length of GMPE weights equals length of gmpe list</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gmpes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Length of weights must match length of GMPE list.&#39;</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Check that gmpes is a list of OQ GMPE instances</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">GMPE</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">IPE</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> is not a GMPE or IPE instance.&quot;</span> <span class="o">%</span> <span class="n">g</span><span class="p">)</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GMPES</span> <span class="o">=</span> <span class="n">gmpes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">WEIGHTS</span> <span class="o">=</span> <span class="n">weights</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Combine the intensity measure types. This is problematic:</span>
        <span class="c1">#   - Logically, we should only include the intersection of the sets</span>
        <span class="c1">#     of imts for the different GMPEs.</span>
        <span class="c1">#   - In practice, this is not feasible because most GMPEs in CEUS and</span>
        <span class="c1">#     subduction zones do not have PGV.</span>
        <span class="c1">#   - So instead we will use the union of the imts and then convert</span>
        <span class="c1">#     to get the missing imts later in get_mean_and_stddevs.</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="n">imts</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_TYPES</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_TYPES</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">imts</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># For VirtualIPE class, we also want to know if ALL of the GMPEs are</span>
        <span class="c1"># defined for PGV, in which case we will convert from PGV to MI,</span>
        <span class="c1"># otherwise use PGA or Sa.</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">haspgv</span> <span class="o">=</span> <span class="p">[</span><span class="n">PGV</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_TYPES</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALL_GMPES_HAVE_PGV</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">haspgv</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Store intensity measure types for conversion in get_mean_and_stddevs.</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IMCs</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_COMPONENT</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Store the component</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_COMPONENT</span> <span class="o">=</span> <span class="n">imc</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Intersection of GMPE standard deviation types</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">stdlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">DEFINED_FOR_STANDARD_DEVIATION_TYPES</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFINED_FOR_STANDARD_DEVIATION_TYPES</span> <span class="o">=</span> \
            <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="n">stdlist</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Need union of site parameters, but it is complicated by the</span>
        <span class="c1"># different depth parameter flavors.</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">sitepars</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">REQUIRES_SITES_PARAMETERS</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRES_SITES_PARAMETERS</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">sitepars</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Construct a list of whether or not each GMPE has a site term</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HAS_SITE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vs30&#39;</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">REQUIRES_SITES_PARAMETERS</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Checks and sort out defaults</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="c1"># things to check if default_gmpes_for_site is provided</span>
        <span class="k">if</span> <span class="n">default_gmpes_for_site</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check that default_gmpe_for_site are OQ GMPEs or None</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">default_gmpes_for_site</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">GMPE</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> is not a GMPE instance.&quot;</span> <span class="o">%</span> <span class="n">g</span><span class="p">)</span>

            <span class="c1"># apply default weights if necessary</span>
            <span class="k">if</span> <span class="n">default_gmpes_for_site_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_gmpes_for_site</span><span class="p">)</span>
                <span class="n">default_gmpes_for_site_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>

        <span class="c1"># Things to check if one or more GMPE does not have a site term</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HAS_SITE</span><span class="p">):</span>
            <span class="c1"># Raise an exception if no default site is provided</span>
            <span class="k">if</span> <span class="n">default_gmpes_for_site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Must provide default_gmpes_for_site if one or&#39;</span>
                                <span class="s1">&#39; more GMPE does not have site term.&#39;</span><span class="p">)</span>

            <span class="c1"># If weights are unspecified, use equal weight</span>
            <span class="k">if</span> <span class="n">default_gmpes_for_site_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">default_gmpes_for_site_weights</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_gmpes_for_site</span><span class="p">)]</span> <span class="o">*</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="n">default_gmpes_for_site</span><span class="p">)</span>

            <span class="c1"># check that length of default_gmpe_for_site matches length of</span>
            <span class="c1"># default_gmpe_for_site_weights</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_gmpes_for_site_weights</span><span class="p">)</span> <span class="o">!=</span> \
               <span class="nb">len</span><span class="p">(</span><span class="n">default_gmpes_for_site</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Length of default_gmpes_for_site_weights &#39;</span>
                                <span class="s1">&#39;must match length of default_gmpes_for_site &#39;</span>
                                <span class="s1">&#39;list.&#39;</span><span class="p">)</span>

            <span class="c1"># check weights sum to one if needed</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HAS_SITE</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">default_gmpes_for_site_weights</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;default_gmpes_for_site_weights must sum&#39;</span>
                                    <span class="s1">&#39; to one.&#39;</span><span class="p">)</span>

        <span class="c1"># Note: if ALL of the GMPEs do not have a site term (requiring Vs30),</span>
        <span class="c1">#       then REQUIRES_SITES_PARAMETERS for the MultiGMPE will not</span>
        <span class="c1">#       include Vs30 even though it will be needed to compute the</span>
        <span class="c1">#       default site term. So if the site checks have passed to this</span>
        <span class="c1">#       point, we should add Vs30 to the set of required site pars:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRES_SITES_PARAMETERS</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRES_SITES_PARAMETERS</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;vs30&#39;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_GMPES_FOR_SITE</span> <span class="o">=</span> <span class="n">default_gmpes_for_site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_GMPES_FOR_SITE_WEIGHTS</span> <span class="o">=</span> <span class="n">default_gmpes_for_site_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">REFERENCE_VS30</span> <span class="o">=</span> <span class="n">reference_vs30</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Union of rupture parameters</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">ruppars</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">REQUIRES_RUPTURE_PARAMETERS</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRES_RUPTURE_PARAMETERS</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">ruppars</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Union of distance parameters</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">distpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">REQUIRES_DISTANCES</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRES_DISTANCES</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">distpars</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="MultiGMPE.get_site_factors"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.get_site_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_site_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for computing site amplification factors from the defalut GMPE</span>
<span class="sd">        to be applied to GMPEs which do not have a site term.</span>

<span class="sd">        **NOTE** Amps are calculated in natural log units and so the ln(amp)</span>
<span class="sd">        is returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            sites (SitesContext): Instance of SitesContext.</span>
<span class="sd">            rup (RuptureContext): Instance of RuptureContext.</span>
<span class="sd">            dists (DistancesContext): Instance of DistancesContext.</span>
<span class="sd">            imt: An instance openquake.hazardlib.imt.</span>
<span class="sd">            default (bool): Boolean of whether or not to return the</span>
<span class="sd">                amplificaiton factors for the gmpes or default_gmpes_for_site.</span>
<span class="sd">                This argument is primarily only intended to be used internally</span>
<span class="sd">                for when we just need to access the default amplifications to</span>
<span class="sd">                apply to those GMPEs that do not have site terms.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Site amplifications in natural log units.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Make reference sites context</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="n">ref_sites</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>
        <span class="n">ref_sites</span><span class="o">.</span><span class="n">vs30</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="n">vs30</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REFERENCE_VS30</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># If default True, construct new MultiGMPE with default GMPE/weights</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">MultiGMPE</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_GMPES_FOR_SITE</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_GMPES_FOR_SITE_WEIGHTS</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFINED_FOR_INTENSITY_MEASURE_COMPONENT</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># If default False, just use self</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">lmean</span><span class="p">,</span> <span class="n">lsd</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">get_mean_and_stddevs</span><span class="p">(</span>
            <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">DEFINED_FOR_STANDARD_DEVIATION_TYPES</span><span class="p">))</span>
        <span class="n">lmean_ref</span><span class="p">,</span> <span class="n">lsd</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">get_mean_and_stddevs</span><span class="p">(</span>
            <span class="n">ref_sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">DEFINED_FOR_STANDARD_DEVIATION_TYPES</span><span class="p">))</span>

        <span class="n">lamps</span> <span class="o">=</span> <span class="n">lmean</span> <span class="o">-</span> <span class="n">lmean_ref</span>

        <span class="k">return</span> <span class="n">lamps</span></div>

<div class="viewcode-block" id="MultiGMPE.set_sites_depth_parameters"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.set_sites_depth_parameters">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_sites_depth_parameters</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">gmpe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Need to select the appropriate z1pt0 value for different GMPEs.</span>
<span class="sd">        Note that these are required site parameters, so even though</span>
<span class="sd">        OQ has these equations built into the class in most cases.</span>
<span class="sd">        I have submitted an issue to OQ requesting subclasses of these</span>
<span class="sd">        methods that do not require the depth parameters in the</span>
<span class="sd">        SitesContext to make this easier.</span>

<span class="sd">        Args:</span>
<span class="sd">            sites:1 An OQ sites context.</span>
<span class="sd">            gmpe: An OQ GMPE instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An OQ sites context with the depth parameters set for the</span>
<span class="sd">            requested GMPE.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;MultiGMPE()&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sites</span>

        <span class="n">sites</span> <span class="o">=</span> <span class="n">Sites</span><span class="o">.</span><span class="n">_addDepthParameters</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;AbrahamsonEtAl2014()&#39;</span> <span class="ow">or</span> \
           <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;AbrahamsonEtAl2014RegTWN()&#39;</span> <span class="ow">or</span> \
           <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;AbrahamsonEtAl2014RegCHN()&#39;</span><span class="p">:</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0_ask14_cal</span>
        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;AbrahamsonEtAl2014RegJPN()&#39;</span><span class="p">:</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0_ask14_jpn</span>
        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;ChiouYoungs2014()&#39;</span> <span class="ow">or</span> \
           <span class="nb">isinstance</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="n">BooreEtAl2014</span><span class="p">):</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0_cy14_cal</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="n">CampbellBozorgnia2014</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;CampbellBozorgnia2014JapanSite()&#39;</span> <span class="ow">or</span> \
               <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;CampbellBozorgnia2014HighQJapanSite()&#39;</span> <span class="ow">or</span> \
               <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;CampbellBozorgnia2014LowQJapanSite()&#39;</span><span class="p">:</span>
                <span class="n">sites</span><span class="o">.</span><span class="n">z2pt5</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z2pt5_cb14_jpn</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sites</span><span class="o">.</span><span class="n">z2pt5</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z2pt5_cb14_cal</span>
        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;ChiouYoungs2008()&#39;</span> <span class="ow">or</span> \
           <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;Bradley2013()&#39;</span> <span class="ow">or</span> \
           <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;Bradley2013Volc()&#39;</span><span class="p">:</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0_cy08</span>
        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;CampbellBozorgnia2008()&#39;</span><span class="p">:</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">z2pt5</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">z2pt5_cb07</span>
        <span class="k">if</span> <span class="n">gmpe</span> <span class="o">==</span> <span class="s1">&#39;AbrahamsonSilva2008()&#39;</span><span class="p">:</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">z1pt0</span> <span class="o">=</span> <span class="n">gmpe</span><span class="o">.</span><span class="n">_compute_median_z1pt0</span><span class="p">(</span><span class="n">sites</span><span class="o">.</span><span class="n">vs30</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sites</span></div>

<div class="viewcode-block" id="MultiGMPE.describe"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a dictionary that describes the MultiGMPE.</span>

<span class="sd">        Note: For simplicity, this method ignores issues related to</span>
<span class="sd">        GMPEs used for the site term and changes in the GMPE with</span>
<span class="sd">        distance. For this level of detail, please see the config files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary representation of the MultiGMPE.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gmpe_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;gmpes&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTION</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMPES</span><span class="p">)):</span>
            <span class="n">gmpe_dict</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">WEIGHTS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMPES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">MultiGMPE</span><span class="p">):</span>
                <span class="n">gmpe_dict</span><span class="p">[</span><span class="s1">&#39;gmpes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">GMPES</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gmpe_dict</span><span class="p">[</span><span class="s1">&#39;gmpes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMPES</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">gmpe_dict</span></div>

<div class="viewcode-block" id="MultiGMPE.inflatePSSigma"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.MultiGMPE.inflatePSSigma">[docs]</a>    <span class="k">def</span> <span class="nf">inflatePSSigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmpe</span><span class="p">,</span> <span class="n">lmean</span><span class="p">,</span> <span class="n">lsd</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span>
                       <span class="n">stddev_types</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the point-source to finite-fault factors are used, we need to</span>
<span class="sd">        inflate the intra-event and total standard deviations. We do this</span>
<span class="sd">        by standard propagation of error techniques: taking the (numerical)</span>
<span class="sd">        derivative of the GMPE (as a function of distance) squared times the</span>
<span class="sd">        additional variance from the conversion, added</span>
<span class="sd">        to the variance of the GMPE (then taking the square root). We do</span>
<span class="sd">        this separately for each of Rrup and Rjb and sum the results.</span>
<span class="sd">        If Rrup and Rjb are calculated from a finite rupture model, their</span>
<span class="sd">        variance arrays will be &quot;None&quot; and lsd will remain unchanged.</span>
<span class="sd">        Otherwise the error inflation will be applied. Normally one or the</span>
<span class="sd">        other of Rrup/Rjb will not be used and so that term will be zero; in</span>
<span class="sd">        some cases both may be used and both may result in non-zero</span>
<span class="sd">        derivatives.</span>

<span class="sd">        Args:</span>
<span class="sd">            gmpe:</span>
<span class="sd">                The GMPE to use for the calculations. Must be a base GMPE and</span>
<span class="sd">                not a GMPE set, otherwise no action is taken.</span>
<span class="sd">            lmean:</span>
<span class="sd">                The mean values returned by the &quot;normal&quot; evaluation of the</span>
<span class="sd">                GMPE.</span>
<span class="sd">            lsd:</span>
<span class="sd">                The standard deviations returned by the &quot;normal&quot; evaluation</span>
<span class="sd">                of the GMPE.</span>
<span class="sd">            sites:</span>
<span class="sd">                The sites context required by the GMPE.</span>
<span class="sd">            rup:</span>
<span class="sd">                The rupture context required by the GMPE.</span>
<span class="sd">            dists:</span>
<span class="sd">                The distance context required by the GMPE.</span>
<span class="sd">            imt:</span>
<span class="sd">                The intensity measure type being evaluated.</span>
<span class="sd">            stddev_types:</span>
<span class="sd">                The list of stddev types found in lsd.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of arrays of inflated standard deviations</span>
<span class="sd">            corresponding to the elements of lsd.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_sd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delta_distance</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">delta_var</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;rrup&#39;</span><span class="p">,</span> <span class="s1">&#39;rjb&#39;</span><span class="p">)):</span>
            <span class="c1"># Skip dtype if the gmpe does not require it</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gmpe</span><span class="o">.</span><span class="n">REQUIRES_DISTANCES</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Skip dtype if it has not been subject to a point-source to</span>
            <span class="c1"># finite rupture conversion</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">+</span> <span class="s1">&#39;_var&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dvar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Add a small amound to the rupture distance (rrup or rjb)</span>
            <span class="c1"># and re-evaluate the GMPE</span>
            <span class="n">rup_dist</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
            <span class="n">rup_dist</span> <span class="o">+=</span> <span class="n">delta_distance</span>
            <span class="n">tmean</span><span class="p">,</span> <span class="n">tsd</span> <span class="o">=</span> <span class="n">gmpe</span><span class="o">.</span><span class="n">get_mean_and_stddevs</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">rup</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">imt</span><span class="p">,</span>
                                                   <span class="n">stddev_types</span><span class="p">)</span>
            <span class="c1"># Find the derivative w.r.t. the rupture distance</span>
            <span class="n">dm_dr</span> <span class="o">=</span> <span class="p">(</span><span class="n">lmean</span> <span class="o">-</span> <span class="n">tmean</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta_distance</span>
            <span class="c1"># The additional variance is (dm/dr)^2 * dvar</span>
            <span class="n">delta_var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm_dr</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dvar</span>
            <span class="c1"># Put the rupture distance back to what it was</span>
            <span class="n">rup_dist</span> <span class="o">-=</span> <span class="n">delta_distance</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stdtype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stddev_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stdtype</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">StdDev</span><span class="o">.</span><span class="n">INTER_EVENT</span><span class="p">:</span>
                <span class="n">new_sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">continue</span>
            <span class="n">new_sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">new_sd</span></div></div>


<div class="viewcode-block" id="filter_gmpe_list"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.filter_gmpe_list">[docs]</a><span class="k">def</span> <span class="nf">filter_gmpe_list</span><span class="p">(</span><span class="n">gmpes</span><span class="p">,</span> <span class="n">wts</span><span class="p">,</span> <span class="n">imt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to remove GMPEs from the GMPE list that are not applicable</span>
<span class="sd">    to a specific IMT. Rescales the weights to sum to one.</span>

<span class="sd">    Args:</span>
<span class="sd">        gmpes (list): List of GMPE instances.</span>
<span class="sd">        wts (list): List of floats indicating the weight of the GMPEs.</span>
<span class="sd">        imt (IMT): OQ IMT to filter GMPE list for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: List of GMPE instances and list of weights.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">wts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gmpes</span><span class="p">)</span>
        <span class="n">wts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>

    <span class="n">per_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">get_gmpe_sa_periods</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
    <span class="n">per_min</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">get_gmpe_sa_periods</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">imt</span> <span class="o">==</span> <span class="n">PGA</span><span class="p">():</span>
        <span class="n">sgmpe</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gmpes</span> <span class="k">if</span> <span class="n">imt</span> <span class="ow">in</span>
                 <span class="n">get_gmpe_coef_table</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">non_sa_coeffs</span><span class="p">]</span>
        <span class="n">swts</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gmpes</span><span class="p">,</span> <span class="n">wts</span><span class="p">)</span> <span class="k">if</span> <span class="n">imt</span> <span class="ow">in</span>
                <span class="n">get_gmpe_coef_table</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">non_sa_coeffs</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">imt</span> <span class="o">==</span> <span class="n">PGV</span><span class="p">():</span>
        <span class="n">sgmpe</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">swts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gmpes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">imt</span> <span class="ow">in</span> <span class="n">get_gmpe_coef_table</span><span class="p">(</span><span class="n">gmpes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">non_sa_coeffs</span><span class="p">)</span> <span class="ow">or</span>\
               <span class="p">(</span><span class="n">per_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">per_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="n">sgmpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gmpes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">swts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">imt</span><span class="o">.</span><span class="n">period</span>
        <span class="n">sgmpe</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">swts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gmpes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">per_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">per</span> <span class="ow">and</span> <span class="n">per_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">per</span><span class="p">):</span>
                <span class="n">sgmpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gmpes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">swts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sgmpe</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;No applicable GMPEs from GMPE list for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">imt</span><span class="p">))</span>

    <span class="c1"># Scale weights to sum to one</span>
    <span class="n">swts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">swts</span><span class="p">)</span>
    <span class="n">swts</span> <span class="o">=</span> <span class="n">swts</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">swts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sgmpe</span><span class="p">,</span> <span class="n">swts</span></div>


<div class="viewcode-block" id="get_gmpe_sa_periods"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.get_gmpe_sa_periods">[docs]</a><span class="k">def</span> <span class="nf">get_gmpe_sa_periods</span><span class="p">(</span><span class="n">gmpe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to extract the SA periods defined by a GMPE.</span>

<span class="sd">    Args:</span>
<span class="sd">        gmpe (GMPE): A GMPE instance.</span>

<span class="sd">    Retunrs:</span>
<span class="sd">        list: List of periods.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ctab</span> <span class="o">=</span> <span class="n">get_gmpe_coef_table</span><span class="p">(</span><span class="n">gmpe</span><span class="p">)</span><span class="o">.</span><span class="n">sa_coeffs</span>
    <span class="n">ilist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ctab</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">per</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">period</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">per</span></div>


<div class="viewcode-block" id="get_gmpe_coef_table"><a class="viewcode-back" href="../../shakelib/shakelib.multigmpe.html#shakelib.multigmpe.get_gmpe_coef_table">[docs]</a><span class="k">def</span> <span class="nf">get_gmpe_coef_table</span><span class="p">(</span><span class="n">gmpe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for finding the (or &quot;a&quot;) GMPE table.</span>

<span class="sd">    Notes:</span>

<span class="sd">      *  The reason for the complexity here is that there can be multiple</span>
<span class="sd">         coefficient tables, and some of them may not have the sa_coeffs</span>
<span class="sd">         attribute, which is the main reason for getting the table.</span>
<span class="sd">      *  We are also assuming that if there are more than one  coefficient</span>
<span class="sd">         table, the range of periods will be the same across all of the</span>
<span class="sd">         tables.</span>

<span class="sd">    Args:</span>
<span class="sd">        gmpe (GMPE): An OQ GMPE instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The associated coefficient table.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stuff</span> <span class="o">=</span> <span class="n">gmpe</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span>
    <span class="n">coef_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stuff</span> <span class="k">if</span> <span class="s1">&#39;COEFFS&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">coef_sel</span> <span class="ow">in</span> <span class="n">coef_list</span><span class="p">:</span>
        <span class="n">cobj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">gmpe</span><span class="p">,</span> <span class="n">coef_sel</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;sa_coeffs&quot;</span> <span class="ow">in</span> <span class="n">cobj</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">cobj</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;GMPE </span><span class="si">%s</span><span class="s2"> does not contain sa_coeffs attribute.&quot;</span> <span class="o">%</span> <span class="n">gmpe</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/northridge_thumbnail_light_16x9.png" alt="Logo"/>
    
    <h1 class="logo logo-name">ShakeMap Documentation</h1>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual3_5/index.html">ShakeMap 3.5 Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sm4_index.html">ShakeMap v4 Documentation</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
    </div>

    

    
  </body>
</html>